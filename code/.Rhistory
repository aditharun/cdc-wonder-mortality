library(tidyverse); pk <- "~/Downloads/age_2000_standard_population_final.tsv" %>% read_tsv()
aa <- "~/Documents/GitHub/cdc-wonder-mortality/raw-data/age_2000_standard_population_final.tsv" %>% read_tsv()
aa
pk
aa %>% as.data.frame()
library(tidyverse)
setwd("~/Documents/GitHub/cdc-wonder-mortality/code/")
"../raw-data/standard-pop/standard-population.txt" %>% read_table(., header = FALSE)
"../raw-data/standard-pop/standard-population.txt" %>% read.table(.)
"../raw-data/standard-pop/standard-population.txt" %>% read.table(., colClasses = "character")
df <- "../raw-data/standard-pop/standard-population.txt" %>% read.table(., colClasses = "character")
df
df %>% mutate(V1 = str_sub(V1, -7, -1))
df %>% mutate(V1 = str_sub(V1, -8, -1)) %>% as_tibble()
df %>% mutate(V1 = str_sub(V1, -7, -1)) %>% as_tibble()
df %>% mutate(V1 = str_sub(V1, -7, -1)) %>% as_tibble() %>% mutate(idx = (1:n() ) - 1)
df %>% mutate(V1 = str_sub(V1, -7, -1)) %>% as_tibble() %>% mutate(idx = (1:n() ) - 1) %>% arrange(desc(idx))
df %>% mutate(V1 = str_sub(V1, -7, -1)) %>% as_tibble() %>% mutate(idx = (1:n() ) - 1) %>% arrange(desc(idx)) %>% type.convert(as.is = TRUE)
df <- df %>% mutate(V1 = str_sub(V1, -7, -1)) %>% as_tibble() %>% mutate(idx = (1:n() ) - 1) %>% arrange(desc(idx)) %>% type.convert(as.is = TRUE)
aa
df %>% magrittr::set_colnames(c("Population", "Age"))
df %>% magrittr::set_colnames(c("Population", "Age")) %>% relocate(Age)
identical(pk, aa)
all.equal(pk, aa)
df <- df %>% magrittr::set_colnames(c("Population", "Age")) %>% relocate(Age)
aa
df
df <- "../raw-data/standard-pop/standard-population.txt" %>% read.table(., colClasses = "character")
df <- df %>% mutate(V1 = str_sub(V1, -7, -1)) %>% as_tibble() %>% mutate(idx = (1:n() ) - 1) %>% arrange(desc(idx)) %>% type.convert(as.is = TRUE)
df <- df %>% magrittr::set_colnames(c("Population", "Age")) %>% relocate(Age) %>% arrange(Age)
aa
df
aa %>% arrange(desc(Age))
aa %>% left_join(df, by=c("Age"="Age"))
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New"))
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New")) %>% mutate(diff = New - Old)
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New")) %>% mutate(diff = New - Old) %>% pull(diff)
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New")) %>% mutate(diff = New - Old, pct = round((diff / Old)*100, 2))
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New")) %>% mutate(diff = New - Old, pct = round((diff / Old)*100, 2)) %>% ggplot(aes(x=pct)) + geom_density() + theme_bw()
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New")) %>% mutate(diff = New - Old, pct = round((diff / Old)*100, 2)) %>% pull(pct) %>% summary()
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New"))
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New")) %>% mutate(val = Age/5)
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New")) %>% mutate(val = round(Age/5))
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New")) %>% mutate(val = floor(Age/5))
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New")) %>% mutate(val = floor(Age/5)) %>% slice(1:1)
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New")) %>% mutate(val = floor(Age/5)) %>% slice(1:10)
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New")) %>% mutate(val = floor(Age/5)) %>% slice(1:11)
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New")) %>% mutate(val = floor(Age/5)) %>% group_by(val) %>% summarize(o = sum(Old), n = sum(New))
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New")) %>% mutate(val = floor(Age/5)) %>% group_by(val) %>% summarize(o = sum(Old), n = sum(New)) %>% mutate(diff = n - o) %>% mutate(pct = round((diff / o)*100, 2))
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New")) %>% mutate(val = floor(Age/5)) %>% group_by(val) %>% summarize(o = sum(Old), n = sum(New)) %>% mutate(diff = n - o) %>% mutate(pct = round((diff / o)*100, 2)) %>% pull(pct) %>% summary()
aa %>% left_join(df, by=c("Age"="Age")) %>% magrittr::set_colnames(c("Age", "Old", "New")) %>% mutate(val = floor(Age/5)) %>% filter(Age >= 20) %>% filter(Age <= 84) %>% group_by(val) %>% summarize(o = sum(Old), n = sum(New)) %>% mutate(diff = n - o) %>% mutate(pct = round((diff / o)*100, 2)) %>% pull(pct) %>% summary()
df
aa
df <- "../raw-data/standard-pop/standard-population.txt" %>% read.table(., colClasses = "character")
df <- df %>% mutate(V1 = str_sub(V1, -7, -1)) %>% as_tibble() %>% mutate(idx = (1:n() ) - 1) %>% arrange(desc(idx)) %>% type.convert(as.is = TRUE)
df <- df %>% magrittr::set_colnames(c("Population", "Age")) %>% relocate(Age) %>% arrange(Age)
write_tsv(df, "../raw-data/age_2000_standard_population_final.tsv")
